<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Technic</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="" id="pomoContainer"></div>
        <div class="d-flex justify-content-center mb-3">
            <div class="timer " id="timerContainer"></div>

        </div>
        <div class="row">
            <div class="col">
                <button onclick="pomodoro()">Start</button>
            </div>
            <div class="col">
                <button onclick="shortBreak()">Short break</button>
            </div>
            <div class="col">
                <button onclick="longBreak()">Long break</button>
            </div>
            <div class="col">
                <button onclick="pauseTimer()">Pause</button>
            </div>
            <div class="col">
                <button onclick="resetTimer()">Reset</button>
            </div>
        </div>
        <!-- Task -->
        <div class="container">
            <br><br>
            <!-- <h1 class="text-dark"><strong>To do List</strong></h1> -->
            <div class="input-group mb-3">
                <input type="text" class="form-control" id="insertTask" placeholder="Add New Task"
                    aria-label="Add New Task" aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <input class="btn btn-danger" id="insertBtn" type="button" value="New Task" required />
                </div>
            </div>
            <div id="taskContainer">
                <!-- list all task here -->
            </div>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Task</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody id="TaskTableTable">
                    <!-- dynamic tr goes here... -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let seconds = 0;
        let intervalId = null;
        let paused = false;
        let remainingTime = 0;

        function startTimer(timer) {
            const timerContainer = document.getElementById('timerContainer');
            timerContainer.innerHTML = ''; // Clear previous timer
            let span = document.createElement('span');
            span.setAttribute("id", "counter");
            timerContainer.appendChild(span);

            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }

            if (!paused) {
                seconds = 0;
                remainingTime = timer;
            } else {
                paused = false;
            }

            intervalId = setInterval(() => {
                seconds++;
                span.innerHTML = `<b>${seconds}</b>`;

                if (seconds >= remainingTime) {
                    clearInterval(intervalId);
                    intervalId = null;
                    timerContainer.innerHTML = null;
                    seconds = 0;
                }

            }, 1000);
        }

        function pauseTimer() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
                paused = true;
                remainingTime = remainingTime - seconds;
            }
        }

        function resetTimer() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            seconds = 0;
            paused = false;
            remainingTime = 0;
            document.getElementById('timerContainer').innerHTML = '';
        }


        function pomodoro() {
            startTimer(8)
        }
        function shortBreak() {
            startTimer(3000)
        }
        function longBreak() {
            startTimer(9000)
        }

        function sayPomo(id) {

            let tasks = JSON.parse(localStorage.getItem('task')) || [];

            let tobeAddedInPomoQueue = tasks.filter((item) => String(item.id) === String(id));

            // let exsistingQueueTasks = JSON.parse(localStorage.getItem('taskQueue')) || [];
            // exsistingQueueTasks.push(tobeAddedInPomoQueue)
            localStorage.setItem('taskQueue', JSON.stringify(tobeAddedInPomoQueue));

            // time to work!
            let workBox = document.getElementById('pomoContainer');
            // Clear previous content
            workBox.innerHTML = "";
            let div = document.createElement('div');
            div.classList.add("d-flex")
            div.classList.add("justify-content-center")
            div.innerHTML = `
            <h1>${tobeAddedInPomoQueue[0].task}</h1> <button class="btn btn-sm btn-info" onclick="taskCompleted()">Done</button>
            <span hidden id="spanId">${tobeAddedInPomoQueue[0].id}<span>
            `;
            workBox.appendChild(div)



        }

        function taskCompleted() {
            let spanId = document.getElementById('spanId')
            let id = spanId.innerText;
            let taskQueue = JSON.parse(localStorage.getItem('taskQueue')) || [];
            taskQueue.filter((item) => String(item.id) !== String(id));
            localStorage.setItem('taskQueue',JSON.stringify(taskQueue))
            
        }

        // Tasks
        function store(task) {
            let insertTask = document.getElementById('insertTask');
            insertTask.value = null;
            let exsistingTasks = JSON.parse(localStorage.getItem('task')) || [];
            exsistingTasks.push(task);
            localStorage.setItem('task', JSON.stringify(exsistingTasks));
            listTask()
        }
        // add
        function listTask() {
            let tbody = document.getElementById('TaskTableTable');
            tbody.innerHTML = '';

            let tasks = JSON.parse(localStorage.getItem('task')) || [];
            tasks.forEach(item => {
                let tr = document.createElement('tr');
                tr.innerHTML = `
                <td> ${item.id} </td>
                <td> ${item.task} </td>
                <td> 
                    <span onclick="remove('${item.id}')" class="btn btn-danger">Delete</span> &nbsp
                    <span onclick="sayPomo('${item.id}')" class="btn btn-info">sayPomo</span>
                </td>
                `;
                tbody.appendChild(tr);


            });

        }
        // remove
        function remove(id) {
            let tasks = JSON.parse(localStorage.getItem('task')) || [];
            tasks = tasks.filter((item) => String(item.id) !== String(id));
            localStorage.setItem('task', JSON.stringify(tasks));
            listTask()
        }

        // target task form
        document.getElementById('insertBtn').addEventListener('click', () => {
            let inputText = document.getElementById('insertTask').value.trim();
            let id = '_' + Math.random(Math.floor()).toString().substring(9, 2);
            let input = document.getElementById('insertTask');
            if (!inputText) {
                input.classList.add('border-danger')
                return;
            } else {
                input.classList.remove('border-danger')
                store({ id: id, task: inputText });
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            listTask();
        })


    </script>
</body>

</html>